
<%
  kind = caption.at(0).downcase
  kind = 'r' if kind == '&'
-%>

<caption><%= caption %></caption>

<% unless index_start >= @players.size -%>
  <% @players[index_start, size].each_with_index do |player, index| -%>
    <% clazz = player.on_loan?(@season_id)      ? 'on_loan' \
             : @injury_list.include?(player.id) ? 'injury_list' \
                                                : '' -%>
    <tr class="<%= clazz %>">
      <% if kind == 's' -%>
        <% position = @formation.position(index + 1) -%>
        <td style="background-color: <%= position.color %>;
                   text-align: center; font-size: small; font-weight: bold;">
          <%= position.name %>
        </td>
      <% end -%>
      <td class="index_number">
        <% label = "#{kind}#{index + index_offset + 1}" -%>
        <%= link_to label, :action => 'show', :id => player, :browses_all_players => 1 %>
      </td>
      <% clazz = kind != 's' || player.positions.include?(position) ? "" : "out_of_position" -%>
      <td class="name <%= clazz %>">
        <%= player.name %>
      </td>
      <td>
        <font size="-1"><%= player.overall %></font>
      </td>
      <td align="center" style="background-color: <%= player.position.color %>">
        <font size="-1"><%= player.position.name %></font>
      </td>
      <td>
        <font size="-2">
          <% player.sub_positions.each do |pos| -%>
            <span style="background-color: <%= pos.color %>">
              <%= pos.name %>
            </span>
          <% end -%>
        </font>
      </td>
    </tr>
  <% end -%>
<% end -%>

